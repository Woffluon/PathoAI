# Dependencies

This document provides a comprehensive overview of PathoAI's dependencies, their purposes, and version constraints.

## Dependency Management

PathoAI uses a multi-file requirements structure for better organization:

- `requirements/base.in`: Direct dependencies with version pins
- `requirements/base.txt`: Compiled dependencies with transitive deps (generated by pip-compile)
- `requirements/production.in`: Production-specific dependencies
- `requirements.txt`: Flattened requirements for simple installation

## Core Dependencies

### Deep Learning Framework

| Package | Version | Purpose |
|---------|---------|---------|
| `tensorflow` | 2.20.0 | Deep learning framework for model inference |
| `keras` | 3.13.2 | High-level neural network API (bundled with TensorFlow) |
| `tensorboard` | 2.20.0 | Visualization toolkit for TensorFlow (transitive) |

**Usage**: TensorFlow powers both the EfficientNetV2-S classification model and the CIA-Net segmentation model. Keras provides the high-level API for model loading and inference.

**Notes**: TensorFlow 2.20.0 includes Keras 3.13.2 by default. GPU support requires CUDA-compatible drivers.

### Numerical Computing

| Package | Version | Purpose |
|---------|---------|---------|
| `numpy` | 2.4.2 | Fundamental array computing library |
| `scipy` | 1.17.0 | Scientific computing (optimization, linear algebra) |
| `pandas` | 2.3.3 | Data manipulation and analysis |

**Usage**:
- `numpy`: Array operations, image manipulation, numerical computations
- `scipy`: Morphological operations, distance transforms, watershed segmentation
- `pandas`: Morphometric feature tables, data export

### Image Processing

| Package | Version | Purpose |
|---------|---------|---------|
| `opencv-python-headless` | 4.13.0.92 | Computer vision library (no GUI) |
| `scikit-image` | 0.26.0 | Image processing algorithms |
| `albumentations` | 2.0.8 | Image augmentation library |
| `pillow` | 12.1.1 | Python Imaging Library (PIL fork) |

**Usage**:
- `opencv-python-headless`: Image I/O, resizing, color space conversions, morphological operations
- `scikit-image`: Watershed segmentation, peak detection, morphological operations
- `albumentations`: Macenko stain normalization, image augmentation
- `pillow`: Image validation, format detection, basic I/O

**Notes**: `opencv-python-headless` is used instead of `opencv-python` to avoid GUI dependencies in Docker.

### Visualization

| Package | Version | Purpose |
|---------|---------|---------|
| `matplotlib` | 3.10.8 | Plotting library for charts and heatmaps |
| `seaborn` | 0.13.2 | Statistical data visualization |

**Usage**:
- `matplotlib`: Grad-CAM heatmaps, probability distributions, morphometric charts
- `seaborn`: Enhanced statistical plots, color palettes

### Web Framework

| Package | Version | Purpose |
|---------|---------|---------|
| `streamlit` | 1.54.0 | Web application framework |
| `flask` | 3.1.0 | Lightweight WSGI web framework |

**Usage**:
- `streamlit`: Main UI framework for the dashboard
- `flask`: Metrics server for Prometheus endpoint

### Monitoring & Observability

| Package | Version | Purpose |
|---------|---------|---------|
| `prometheus-client` | 0.21.1 | Prometheus metrics exporter |
| `sentry-sdk` | 2.19.2 | Error tracking and performance monitoring |
| `psutil` | 6.1.1 | System and process utilities |

**Usage**:
- `prometheus-client`: Export metrics (request count, inference duration, memory usage)
- `sentry-sdk`: Capture errors, performance traces, and profiling data
- `psutil`: Monitor memory usage, CPU usage, process information

### Report Generation

| Package | Version | Purpose |
|---------|---------|---------|
| `fpdf2` | 2.7.6 | PDF generation library |

**Usage**: Generate downloadable PDF reports with analysis results, images, and findings.

### HTTP & Networking

| Package | Version | Purpose |
|---------|---------|---------|
| `requests` | 2.32.5 | HTTP library for API calls |

**Usage**: Future feature for model download and external API integration.

## Transitive Dependencies

These packages are installed automatically as dependencies of the core packages:

### TensorFlow Dependencies

- `absl-py` (2.4.0): Abseil Python library for TensorFlow
- `astunparse` (1.6.3): AST unparser for TensorFlow
- `flatbuffers` (25.12.19): Serialization library for TensorFlow Lite
- `gast` (0.7.0): AST manipulation for TensorFlow
- `google-pasta` (0.2.0): AST manipulation for TensorFlow
- `grpcio` (1.78.0): gRPC framework for TensorFlow Serving
- `h5py` (3.15.1): HDF5 file format for model storage
- `libclang` (18.1.1): Python bindings for Clang (TensorFlow build)
- `ml-dtypes` (0.5.4): Machine learning data types
- `opt-einsum` (3.4.0): Optimized Einstein summation
- `protobuf` (6.33.5): Protocol buffers for TensorFlow
- `tensorboard-data-server` (0.7.2): TensorBoard backend
- `termcolor` (3.3.0): Terminal color output
- `wrapt` (2.1.1): Decorator utilities

### Streamlit Dependencies

- `altair` (6.0.0): Declarative visualization library
- `blinker` (1.9.0): Signal/event system
- `cachetools` (6.2.6): Caching utilities
- `gitpython` (3.1.46): Git repository interaction
- `pydeck` (0.9.1): WebGL-powered visualization
- `pyarrow` (23.0.0): Apache Arrow for data interchange
- `tenacity` (9.1.4): Retry library
- `toml` (0.10.2): TOML parser
- `tornado` (6.5.4): Asynchronous networking library
- `watchdog` (6.0.0): File system event monitoring

### Image Processing Dependencies

- `albucore` (0.0.24): Core utilities for Albumentations
- `imageio` (2.37.2): Image I/O library
- `networkx` (3.6.1): Graph algorithms for scikit-image
- `pydantic` (2.12.5): Data validation for Albumentations
- `pyyaml` (6.0.3): YAML parser for Albumentations
- `tifffile` (2026.1.28): TIFF file I/O

### Visualization Dependencies

- `contourpy` (1.3.3): Contour calculation for Matplotlib
- `cycler` (0.12.1): Composable style cycles for Matplotlib
- `fonttools` (4.61.1): Font manipulation for Matplotlib
- `kiwisolver` (1.4.9): Constraint solver for Matplotlib layout
- `pyparsing` (3.3.2): Parser for Matplotlib

### Utility Dependencies

- `attrs` (25.4.0): Classes without boilerplate
- `certifi` (2026.1.4): Root certificates for SSL
- `charset-normalizer` (3.4.4): Character encoding detection
- `click` (8.3.1): Command-line interface creation
- `colorama` (0.4.6): Cross-platform colored terminal text
- `defusedxml` (0.7.1): XML bomb protection
- `gitdb` (4.0.12): Git object database
- `idna` (3.11): Internationalized domain names
- `itsdangerous` (2.2.0): Secure data signing
- `jinja2` (3.1.6): Template engine
- `jsonschema` (4.26.0): JSON schema validation
- `lazy-loader` (0.4): Lazy module loading
- `markdown` (3.10.2): Markdown parser
- `markdown-it-py` (4.0.0): Markdown parser (alternative)
- `markupsafe` (3.0.3): Safe string handling
- `mdurl` (0.1.2): Markdown URL utilities
- `namex` (0.1.0): Name extraction utilities
- `narwhals` (2.16.0): DataFrame abstraction layer
- `optree` (0.18.0): Tree data structure utilities
- `packaging` (26.0): Package version handling
- `pygments` (2.19.2): Syntax highlighting
- `python-dateutil` (2.9.0.post0): Date/time utilities
- `pytz` (2025.2): Timezone definitions
- `referencing` (0.37.0): JSON reference resolution
- `rich` (14.3.2): Rich text and formatting
- `rpds-py` (0.30.0): Persistent data structures
- `simsimd` (6.5.12): SIMD-accelerated similarity metrics
- `six` (1.17.0): Python 2/3 compatibility
- `smmap` (5.0.2): Memory-mapped file support
- `stringzilla` (4.6.0): Fast string operations
- `typing-extensions` (4.15.0): Backported typing features
- `typing-inspection` (0.4.2): Runtime type inspection
- `tzdata` (2025.3): Timezone database
- `urllib3` (2.6.3): HTTP client
- `werkzeug` (3.1.5): WSGI utilities
- `wheel` (0.46.3): Wheel package format

## System Dependencies (Docker)

These system packages are required in the Docker container:

```dockerfile
# Runtime dependencies
ffmpeg              # Video/audio processing (for OpenCV)
libsm6              # X11 Session Management library
libxext6            # X11 extensions library
libglib2.0-0        # GLib library
libgl1              # OpenGL library
ca-certificates     # SSL certificates

# Build dependencies (builder stage only)
build-essential     # GCC, make, etc.
git                 # Version control
```

## Python Version Requirement

- **Minimum**: Python 3.10
- **Recommended**: Python 3.10 or 3.11
- **Tested**: Python 3.10

**Rationale**: Python 3.10 is required for:
- Modern type hints (PEP 604, PEP 612)
- Structural pattern matching (PEP 634)
- Better error messages
- Performance improvements

## Dependency Installation

### Development Installation

```bash
# Install base dependencies
pip install -r requirements/base.txt

# Install development dependencies
pip install -r requirements/development.txt
```

### Production Installation

```bash
# Install production dependencies
pip install -r requirements/production.txt
```

### Updating Dependencies

```bash
# Update base.txt from base.in
pip-compile requirements/base.in --output-file requirements/base.txt

# Update production.txt from production.in
pip-compile requirements/production.in --output-file requirements/production.txt
```

## Security Considerations

### Known Vulnerabilities

As of 2026-02-17, no known critical vulnerabilities in pinned versions.

### Dependency Scanning

Recommended tools:
- `pip-audit`: Scan for known vulnerabilities
- `safety`: Check against safety database
- Dependabot: Automated dependency updates (GitHub)

```bash
# Scan for vulnerabilities
pip install pip-audit
pip-audit -r requirements.txt
```

### Version Pinning Strategy

- **Exact pins** for core dependencies (TensorFlow, Streamlit)
- **Compatible release** for utilities (`~=` operator)
- **Minimum version** for transitive dependencies

**Rationale**: Exact pins ensure reproducible builds and prevent breaking changes.

## License Compatibility

All dependencies use permissive licenses compatible with MIT:

- **Apache 2.0**: TensorFlow, Keras, Albumentations, Prometheus Client
- **BSD**: NumPy, SciPy, Pandas, scikit-image, Matplotlib
- **MIT**: Streamlit, Flask, Requests, Pillow, Seaborn
- **PSF**: Python Standard Library components

**Note**: No GPL or AGPL dependencies that would require source disclosure.

## Dependency Graph

```
PathoAI
├── tensorflow (2.20.0)
│   ├── keras (3.13.2)
│   ├── tensorboard (2.20.0)
│   ├── numpy (2.4.2)
│   ├── protobuf (6.33.5)
│   └── ... (15+ transitive deps)
├── streamlit (1.54.0)
│   ├── altair (6.0.0)
│   ├── pandas (2.3.3)
│   ├── numpy (2.4.2)
│   ├── pillow (12.1.1)
│   └── ... (20+ transitive deps)
├── opencv-python-headless (4.13.0.92)
│   └── numpy (2.4.2)
├── scikit-image (0.26.0)
│   ├── numpy (2.4.2)
│   ├── scipy (1.17.0)
│   ├── pillow (12.1.1)
│   └── ... (5+ transitive deps)
├── albumentations (2.0.8)
│   ├── numpy (2.4.2)
│   ├── opencv-python-headless (4.13.0.92)
│   ├── pydantic (2.12.5)
│   └── ... (3+ transitive deps)
├── matplotlib (3.10.8)
│   ├── numpy (2.4.2)
│   ├── pillow (12.1.1)
│   └── ... (5+ transitive deps)
├── seaborn (0.13.2)
│   ├── matplotlib (3.10.8)
│   ├── pandas (2.3.3)
│   └── numpy (2.4.2)
├── prometheus-client (0.21.1)
├── sentry-sdk (2.19.2)
├── psutil (6.1.1)
├── fpdf2 (2.7.6)
│   └── pillow (12.1.1)
├── flask (3.1.0)
│   ├── werkzeug (3.1.5)
│   ├── jinja2 (3.1.6)
│   └── ... (3+ transitive deps)
└── requests (2.32.5)
    ├── certifi (2026.1.4)
    ├── charset-normalizer (3.4.4)
    ├── idna (3.11)
    └── urllib3 (2.6.3)
```

## Troubleshooting

### Common Installation Issues

**Problem**: `ERROR: Could not find a version that satisfies the requirement tensorflow==2.20.0`

**Solution**: Ensure Python 3.10+ and upgrade pip:
```bash
python --version  # Should be 3.10+
pip install --upgrade pip
```

**Problem**: `ImportError: libGL.so.1: cannot open shared object file`

**Solution**: Install system dependencies:
```bash
# Ubuntu/Debian
sudo apt-get install libgl1 libglib2.0-0

# CentOS/RHEL
sudo yum install mesa-libGL glib2
```

**Problem**: `ModuleNotFoundError: No module named 'cv2'`

**Solution**: Reinstall OpenCV:
```bash
pip uninstall opencv-python opencv-python-headless
pip install opencv-python-headless==4.13.0.92
```

---

*For installation instructions, see the [Quickstart Guide](quickstart.md)*
